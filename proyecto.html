<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Detalle del Proyecto de Ayleen Bahamóndez">
    <title id="project-title-meta">Cargando Proyecto...</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Le Murmure';
            src: url('https://velvetyne.fr/fonts/le-murmure/le-murmure.woff2') format('woff2'),
                 url('https://velvetyne.fr/fonts/le-murmure/le-murmure.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
    </style>
    <link rel="stylesheet" href="style.css">
</head>
<body class="light-project-body">
    
    <a href="index.html#home" class="logo-portafolio black-logo">Portafolio</a>

    <button class="menu-toggle" id="menuToggle" aria-label="Abrir menú">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <nav class="side-menu" id="sideMenu">
        <ul class="main-menu">
            <li><a href="index.html#home" class="main-link" data-translate="nav-home">Inicio</a></li>
            <li><a href="index.html#about" class="main-link" data-translate="nav-about">Sobre mí</a></li>
            <li><a href="index.html#work" class="main-link" data-translate="nav-work">Proyectos</a></li>
            <li><a href="index.html#contact" class="main-link" data-translate="nav-contact">Contacto</a></li>
        </ul>
    </nav>

    <div class="overlay" id="overlay"></div>

    <section class="project-page">
        <div class="project-header">
            <h1 class="project-title" id="projectTitle"></h1>
            <p class="project-category" id="projectCategory"></p>

            <div class="project-meta-grid">
                <div class="meta-item">
                    <strong>AÑO</strong>
                    <p id="projectYear"></p>
                </div>
                <div class="meta-item">
                    <strong>CONTEXTO</strong>
                    <p id="projectContext"></p>
                </div>
                <div class="meta-item">
                    <strong>FORMATO</strong> <p id="projectRole"></p>
                </div>
                <div class="meta-item">
                    <strong>SOFTWARE</strong>
                    <p id="projectPrograms"></p>
                </div>
            </div>
        </div>

        <div class="project-main-image" id="projectMainImage">
            </div>

        <div class="project-content-grid">
            <div class="project-description-block">
                <h3 class="description-title">Descripción Detallada</h3>
                <div class="project-description" id="projectDescription">
                    </div>
            </div>

            <div class="project-gallery" id="projectGallery">
                </div>
        </div>
        
        <div class="color-palette-section scroll-animate">
            <h3 class="palette-title">Paleta de Colores</h3>
            <div class="palette-container" id="colorPaletteContainer">
                </div>
        </div>

        <div class="other-projects-section">
            <h3 class="other-projects-title">Otros Proyectos que Podrían Interesarte</h3>
            
            <div class="carousel-track" id="otherProjectsCarousel">
                </div>
        </div>
    </section>

    <section class="contact-section">
        <div class="contact-container">
            <footer class="contact-footer scroll-animate">
                <div class="footer-left">
                    <p>© 2025 Ayleen Bahamóndez</p>
                    <p class="credits" data-translate="footer-credits">Diseñado y programado por mí</p>
                </div>
                <div class="footer-right">
                    <p>Santiago, Chile</p>
                    <a href="index.html#home" class="back-to-top" data-translate="back-top">Volver al inicio →</a>
                </div>
            </footer>
        </div>
    </section>

    <script src="script.js"></script>
    <script>
        // Lógica específica para la página de proyecto (debe ir después de cargar script.js)
        document.addEventListener('DOMContentLoaded', initProjectPage);

        function initProjectPage() {
            // Desactivar el color de fondo dinámico del body para esta página
            document.body.style.backgroundColor = '#ffffff';

            const urlParams = new URLSearchParams(window.location.search);
            const projectSlug = urlParams.get('slug');
            
            // Obtenemos los proyectos de localStorage
            const allProjects = JSON.parse(localStorage.getItem('proyectos'));
            const project = allProjects ? allProjects.find(p => p.slug === projectSlug) : null;

            if (!project) {
                document.getElementById('projectTitle').textContent = 'Proyecto No Encontrado';
                return;
            }

            // 1. Rellenar Información del Proyecto
            document.getElementById('projectTitle').textContent = project.title;
            document.getElementById('projectCategory').textContent = project.category;
            document.getElementById('projectYear').textContent = project.year;
            document.getElementById('projectContext').textContent = project.context;
            document.getElementById('projectRole').textContent = project.role_short || project.role; // Usamos la versión corta para el metadato
            document.getElementById('projectPrograms').textContent = project.programs;
            
            // Formatear la descripción usando saltos de línea (\n)
            document.getElementById('projectDescription').innerHTML = project.description_full.split('\n').map(p => p.trim() ? `<p class="scroll-animate">${p.trim()}</p>` : '').join('');
            
            document.getElementById('project-title-meta').textContent = `${project.title} · Portafolio Ayleen Bahamóndez`;


            // 2. Cargar Imagen Principal
            document.getElementById('projectMainImage').innerHTML = `<img src="${project.photo}" alt="Imagen principal de ${project.title}">`;

            // 3. Cargar Galería de Imágenes y Sketchfab
            const galleryContainer = document.getElementById('projectGallery');
            galleryContainer.innerHTML = ''; 
            
            // Añadir Sketchfab Embed
            if (project.sketchfab_id) {
                galleryContainer.innerHTML += `
                    <div class="sketchfab-embed-container gallery-item scroll-animate">
                        <iframe title="${project.title} Modelo 3D" 
                                frameborder="0" 
                                allowfullscreen 
                                mozallowfullscreen="true" 
                                webkitallowfullscreen="true" 
                                allow="autoplay; fullscreen; xr-spatial-tracking" 
                                xr-spatial-tracking 
                                execution-while-out-of-viewport 
                                execution-while-not-rendered 
                                web-share 
                                src="https://sketchfab.com/models/${project.sketchfab_id}/embed?autostart=0&amp;ui_theme=dark&amp;dnt=1">
                        </iframe>
                        <p class="gallery-caption">Modelo 3D interactivo. Ver más en <a href="https://sketchfab.com/ayleen.bahamndez" target="_blank">Sketchfab</a>.</p>
                    </div>
                `;
            }

            // Añadir Imágenes Adicionales
            const folder = project.photo_folder || project.slug; 
            const count = project.images_count || 0;
            
            for (let i = 1; i <= count; i++) {
                // La ruta sigue el formato img/carpeta/carpeta-1.webp
                galleryContainer.innerHTML += `
                    <div class="gallery-item scroll-animate">
                        <img src="img/${folder}/${folder}-${i}.webp" alt="${project.title} - Foto ${i}" loading="lazy">
                    </div>
                `;
            }

            // Aplicar animaciones de scroll a los nuevos elementos
            document.querySelectorAll('.project-gallery .scroll-animate').forEach(el => {
                observer.observe(el);
            });
            document.querySelectorAll('.project-description-block .scroll-animate').forEach(el => {
                observer.observe(el);
            });
            
            // 4. Cargar Paleta de Colores
            const paletteContainer = document.getElementById('colorPaletteContainer');
            if (project.palette && Array.isArray(project.palette) && project.palette.length > 0) {
                paletteContainer.innerHTML = project.palette.map(color => `
                    <div class="color-swatch scroll-animate" style="background-color: ${color};">
                        <span class="color-code" style="color: ${isDark(color) ? '#ffffff' : '#202020'};">${color}</span>
                    </div>
                `).join('');
                
                // Observar swatches de color
                document.querySelectorAll('.color-swatch.scroll-animate').forEach(el => {
                    observer.observe(el);
                });
                
            } else {
                document.querySelector('.color-palette-section').style.display = 'none';
            }

            // Función para determinar si el color de fondo es oscuro
            function isDark(hex) {
                const c = hex.substring(1);      
                const rgb = parseInt(c, 16);     
                const r = (rgb >> 16) & 0xff;    
                const g = (rgb >>  8) & 0xff;    
                const b = (rgb >>  0) & 0xff;    
                const luma = 0.2126 * r + 0.7152 * g + 0.0722 * b; 
                return luma < 150; 
            }

            // 5. Cargar Carrusel de "Otros Proyectos" (Radiant Style)
            const otherProjectsCarousel = document.getElementById('otherProjectsCarousel');
            if (allProjects) {
                // Filtramos el proyecto actual y mezclamos el resto
                const filteredProjects = allProjects.filter(p => p.slug !== projectSlug);
                
                if (filteredProjects.length > 0) {
                     const shuffledProjects = filteredProjects.sort(() => 0.5 - Math.random()).slice(0, 4); 

                    otherProjectsCarousel.innerHTML = shuffledProjects.map(p => `
                        <div class="card-wrapper scroll-animate">
                            <a href="proyecto.html?slug=${p.slug}" class="project-card" tabindex="0" role="article" aria-label="${p.title}">
                                <div class="card-image">
                                    <img src="${p.photo}" alt="${p.title}" loading="lazy" onerror="this.src='img/placeholder.webp'">
                                </div>
                                <div class="card-content">
                                    <span class="card-category">${p.category}</span>
                                    <h3 class="card-title">${p.title}</h3>
                                    <span class="card-year">${p.year}</span>
                                    <span class="card-more">Ver proyecto →</span>
                                </div>
                            </a>
                        </div>
                    `).join('');

                    // Aplicar animaciones
                    document.querySelectorAll('.other-projects-section .scroll-animate').forEach(el => {
                        observer.observe(el);
                    });
                    
                    // 6. Inicializar la Navegación del Carrusel Dinámico
                    const section = document.querySelector('.other-projects-section');
                    const controls = document.createElement('div');
                    controls.className = 'carousel-controls';
                    
                    const tempPrevBtn = document.createElement('button');
                    tempPrevBtn.className = 'carousel-btn';
                    tempPrevBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>';
                    tempPrevBtn.setAttribute('aria-label', 'Anterior proyecto');
                    
                    const tempNextBtn = document.createElement('button');
                    tempNextBtn.className = 'carousel-btn';
                    tempNextBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>';
                    tempNextBtn.setAttribute('aria-label', 'Siguiente proyecto');
                    
                    controls.appendChild(tempPrevBtn);
                    controls.appendChild(tempNextBtn);
                    
                    const titleElement = section.querySelector('.other-projects-title');
                    titleElement.insertAdjacentElement('afterend', controls);

                    // Lógica de scroll para el carrusel de otros proyectos
                    const getScrollAmount = () => {
                        const firstCard = otherProjectsCarousel.querySelector('.card-wrapper');
                        return firstCard ? firstCard.offsetWidth + 35 : 300;
                    };
                    
                    tempNextBtn.addEventListener('click', () => {
                        const amount = getScrollAmount();
                        const maxScroll = otherProjectsCarousel.scrollWidth - otherProjectsCarousel.clientWidth;
                        
                        if (otherProjectsCarousel.scrollLeft >= maxScroll - 10) {
                            otherProjectsCarousel.scrollTo({ left: 0, behavior: 'smooth' });
                        } else {
                            otherProjectsCarousel.scrollBy({ left: amount, behavior: 'smooth' });
                        }
                    });

                    tempPrevBtn.addEventListener('click', () => {
                        const amount = getScrollAmount();
                        
                        if (otherProjectsCarousel.scrollLeft <= 10) {
                            otherProjectsCarousel.scrollTo({ left: otherProjectsCarousel.scrollWidth, behavior: 'smooth' });
                        } else {
                            otherProjectsCarousel.scrollBy({ left: -amount, behavior: 'smooth' });
                        }
                    });
                } else {
                     // Si no hay suficientes proyectos para mostrar (ej. solo tienes 1), ocultamos la sección
                     section.style.display = 'none';
                }
            }
        }
    </script>
</body>
</html>
